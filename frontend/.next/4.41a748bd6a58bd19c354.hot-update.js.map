{"version":3,"file":"4.41a748bd6a58bd19c354.hot-update.js","sources":["webpack:///pages/index.js"],"sourcesContent":["import React, { Component } from 'react'\nimport firebase from 'firebase'\nimport axios from 'axios';\nimport 'isomorphic-unfetch'\nimport clientCredentials from '../credentials/client'\n\nexport default class Index extends Component {\n  static async getInitialProps ({req, query}) {\n    const user = req && req.session ? req.session.decodedToken : null\n    return { user }\n  }\n\n  constructor (props) {\n    super(props)\n    this.state = {\n      user: this.props.user,\n      error: '',\n      createError: '',\n      long: '',\n      short: '',\n      redirects: [],\n    }\n\n  }\n\n  componentDidMount () {\n    firebase.initializeApp(clientCredentials)\n\n    // if (this.state.user) this.addDbListener()\n\n    firebase.auth().onAuthStateChanged(user => {\n      if (user) {\n        return user.getIdToken()\n          .then((token) => {\n            // eslint-disable-next-line no-undef\n            return fetch('/api/login', {\n              method: 'POST',\n              // eslint-disable-next-line no-undef\n              headers: new Headers({ 'Content-Type': 'application/json' }),\n              credentials: 'same-origin',\n              body: JSON.stringify({ token })\n            })\n          }).then((res) => {\n            if (res.status === 403) {\n              this.setState({ user: null, error: 'Must be an @ocean.org email address.' })\n            } else {\n              this.getRedirects()\n              this.setState({ user: user, error: '' })\n            }\n          })\n      } else {\n        this.setState({ user: null })\n        // eslint-disable-next-line no-undef\n        fetch('/api/logout', {\n          method: 'POST',\n          credentials: 'same-origin'\n        })\n      }\n    })\n  }\n\n  handleLogin () {\n    firebase.auth().signInWithPopup(new firebase.auth.GoogleAuthProvider())\n  }\n\n  handleLogout () {\n    firebase.auth().signOut()\n  }\n\n  removeRedirect = (id, i) => {\n    axios.post('https://us-central1-ocean-wise-186900.cloudfunctions.net/removeRedirect', { id })\n      .then(() => {\n        var redirects = this.state.redirects;\n        redirects = redirects.filter((x, j) => j !== i)\n        this.setState({ redirects })\n      })\n  }\n\n  getRedirects = () => {\n    axios.get('https://us-central1-ocean-wise-186900.cloudfunctions.net/getAllRedirects')\n      .then((res) => {\n        console.log(res.data)\n        const redirects = [];\n        res.data.forEach((redirect, i) => {\n          redirects.push(\n            <tr style={{ textAlign: 'center' }} key={`redirect-${redirect.id}`}>\n              <td><h4>{redirect.long}</h4></td>\n              <td><h3>{redirect.short}</h3></td>\n              <td><span>{redirect.clicks}</span></td>\n              <td><button onClick={() => this.removeRedirect(redirect.id, i)}>Remove?</button></td>\n            </tr>\n          )\n        })\n        this.setState({ redirects })\n      })\n  }\n\n  handleLong = (evt) => {\n    this.setState({ long: evt.target.value })\n  }\n  handleShort = (evt) => {\n    this.setState({ short: evt.target.value })\n  }\n\n  handleCreate = () => {\n    const { long, short } = this.state;\n    console.log(long);\n    if ( !(/^(ftp|https?):\\/\\/[^ \"]+$/g.test(long)) ) {\n      this.setState({ createError: 'Long URL must be a valid URL '});\n    } else {\n      axios.post('https://us-central1-ocean-wise-186900.cloudfunctions.net/createRedirect', { long, short })\n        .then((res) => {\n          var redirects = this.state.redirects;\n          redirects.push(\n            <tr style={{ textAlign: 'center' }} key={`redirect-${short}`}>\n              <td><h4>{long}</h4></td>\n              <td><h3>{res.data}</h3></td>\n              <td><span>0</span></td>\n            </tr>\n          )\n          console.log(redirects)\n          this.setState({ redirects, createError: '' })\n          window.location.reload(true)\n        })\n    }\n  }\n\n  render () {\n    const { user, error, redirects, createError } = this.state\n\n    return (\n      <div>\n        <div style={{ marginBottom: 50, display: 'flex', justifyContent: 'center', flexDirection: 'column', maxWidth: 750, margin: '0 auto' }}>\n          {user ? <button onClick={this.handleLogout}>Logout</button> : <button onClick={this.handleLogin}>Login</button>}\n          { error !== '' ? <span style={{ color: 'red', textAlign: 'center' }}>{error}</span> : ''}\n        </div>\n        { user &&\n          <div style={{ display: 'flex', justifyContent: 'center', margin: '50px auto', flexDirection: 'column', maxWidth: 750 }}>\n            <label>\n              The full URL to shorten (required):\n              <input type=\"text\" value={this.state.long} onChange={this.handleLong} />\n            </label>\n            <label>\n              The short URL you want (optional; e.g., 'compost'):\n              <input type=\"text\" value={this.state.short} onChange={this.handleShort} />\n            </label>\n            <button onClick={this.handleCreate}>Shorten URL</button>\n            <span style={{ color: 'red' }}>{createError}</span>\n          </div>\n        }\n        { user &&\n          <table style={{ width: '100%' }}>\n            <tbody>\n              <tr>\n                <th style={{ width: '40%' }}>Long</th>\n                <th>Short</th>\n                <th>Clicks</th>\n              </tr>\n            </tbody>\n            {redirects}\n          </table>\n        }\n      </div>\n    )\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// pages/index.js"],"mappings":"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","sourceRoot":""}