{"version":3,"file":"bundles/pages/index.js","sources":["webpack:///webpack/bootstrap 7a7776137f637c16237c","webpack:///credentials/client.js","webpack:///pages/index.js","webpack:///external \"@babel/runtime/regenerator\"","webpack:///external \"axios\"","webpack:///external \"firebase\"","webpack:///external \"isomorphic-unfetch\"","webpack:///external \"react\""],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tvar threw = true;\n \t\ttry {\n \t\t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n \t\t\tthrew = false;\n \t\t} finally {\n \t\t\tif(threw) delete installedModules[moduleId];\n \t\t}\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 7a7776137f637c16237c","module.exports = {\n  apiKey: \"AIzaSyBSpXL0Ytp-75WQKpWR_eiWRpgZkeud-6Y\",\n  authDomain: \"ocean-wise-186900.firebaseapp.com\",\n  databaseURL: \"https://ocean-wise-186900.firebaseio.com\",\n  projectId: \"ocean-wise-186900\",\n  storageBucket: \"ocean-wise-186900.appspot.com\",\n  messagingSenderId: \"255540484592\"\n}\n\n\n\n// WEBPACK FOOTER //\n// credentials/client.js","import React, { Component } from 'react'\nimport firebase from 'firebase'\nimport axios from 'axios';\nimport 'isomorphic-unfetch'\nimport clientCredentials from '../credentials/client'\n\nexport default class Index extends Component {\n  static async getInitialProps ({req, query}) {\n    const user = req && req.session ? req.session.decodedToken : null\n    return { user }\n  }\n\n  constructor (props) {\n    super(props)\n    this.state = {\n      user: this.props.user,\n      error: '',\n      createError: '',\n      long: '',\n      short: '',\n      redirects: [],\n    }\n\n  }\n\n  componentDidMount () {\n    firebase.initializeApp(clientCredentials)\n\n    // if (this.state.user) this.addDbListener()\n\n    firebase.auth().onAuthStateChanged(user => {\n      if (user) {\n        return user.getIdToken()\n          .then((token) => {\n            // eslint-disable-next-line no-undef\n            return fetch('/api/login', {\n              method: 'POST',\n              // eslint-disable-next-line no-undef\n              headers: new Headers({ 'Content-Type': 'application/json' }),\n              credentials: 'same-origin',\n              body: JSON.stringify({ token })\n            })\n          }).then((res) => {\n            if (res.status === 403) {\n              this.setState({ user: null, error: 'Must be an @ocean.org email address.' })\n            } else {\n              this.getRedirects()\n              this.setState({ user: user, error: '' })\n            }\n          })\n      } else {\n        this.setState({ user: null })\n        // eslint-disable-next-line no-undef\n        fetch('/api/logout', {\n          method: 'POST',\n          credentials: 'same-origin'\n        })\n      }\n    })\n  }\n\n  handleLogin () {\n    firebase.auth().signInWithPopup(new firebase.auth.GoogleAuthProvider())\n  }\n\n  handleLogout () {\n    firebase.auth().signOut()\n  }\n\n  removeRedirect = (id, i) => {\n    axios.post('https://us-central1-ocean-wise-186900.cloudfunctions.net/removeRedirect', { id })\n      .then(() => {\n        var redirects = this.state.redirects;\n        redirects = redirects.filter((x, j) => j !== i)\n        this.setState({ redirects })\n      })\n  }\n\n  getRedirects = () => {\n    axios.get('https://us-central1-ocean-wise-186900.cloudfunctions.net/getAllRedirects')\n      .then((res) => {\n        const redirects = [];\n        res.data.forEach((redirect, i) => {\n          redirects.push(\n            <tr style={{ textAlign: 'center' }} key={`redirect-${redirect.id}`}>\n              <td><h4>{redirect.long}</h4></td>\n              <td><h3>{redirect.short}</h3></td>\n              <td><span>{redirect.clicks}</span></td>\n              <td><button onClick={() => this.removeRedirect(redirect.id, i)}>Remove?</button></td>\n            </tr>\n          )\n        })\n        this.setState({ redirects })\n      })\n  }\n\n  handleLong = (evt) => {\n    this.setState({ long: evt.target.value })\n  }\n  handleShort = (evt) => {\n    this.setState({ short: evt.target.value })\n  }\n\n  handleCreate = () => {\n    const { long, short } = this.state;\n    if ( !(/^(ftp|https?):\\/\\/[^ \"]+$/g.test(long)) ) {\n      this.setState({ createError: 'Long URL must be a valid URL '});\n    } else {\n      axios.post('https://us-central1-ocean-wise-186900.cloudfunctions.net/createRedirect', { long, short })\n        .then((res) => {\n          var redirects = this.state.redirects;\n          redirects.push(\n            <tr style={{ textAlign: 'center' }} key={`redirect-${short}`}>\n              <td><h4>{long}</h4></td>\n              <td><h3>{res.data}</h3></td>\n              <td><span>0</span></td>\n            </tr>\n          )\n          this.setState({ redirects, createError: '' })\n          window.location.reload(true)\n        })\n    }\n  }\n\n  render () {\n    const { user, error, redirects, createError } = this.state\n\n    return (\n      <div>\n        <div style={{ marginBottom: 50, display: 'flex', justifyContent: 'center', flexDirection: 'column', maxWidth: 750, margin: '0 auto' }}>\n          {user ? <button onClick={this.handleLogout}>Logout</button> : <button onClick={this.handleLogin}>Login</button>}\n          { error !== '' ? <span style={{ color: 'red', textAlign: 'center' }}>{error}</span> : ''}\n        </div>\n        { user &&\n          <div style={{ display: 'flex', justifyContent: 'center', margin: '50px auto', flexDirection: 'column', maxWidth: 750 }}>\n            <label>\n              The full URL to shorten (required):\n              <input type=\"text\" value={this.state.long} onChange={this.handleLong} />\n            </label>\n            <label>\n              The short URL you want (optional; e.g., 'compost'):\n              <input type=\"text\" value={this.state.short} onChange={this.handleShort} />\n            </label>\n            <button onClick={this.handleCreate}>Shorten URL</button>\n            <span style={{ color: 'red' }}>{createError}</span>\n          </div>\n        }\n        { user &&\n          <table style={{ width: '100%' }}>\n            <tbody>\n              <tr>\n                <th style={{ width: '40%' }}>Long</th>\n                <th>Short</th>\n                <th>Clicks</th>\n              </tr>\n            </tbody>\n            {redirects}\n          </table>\n        }\n      </div>\n    )\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// pages/index.js","module.exports = require(\"@babel/runtime/regenerator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@babel/runtime/regenerator\"\n// module id = @babel/runtime/regenerator\n// module chunks = 3","module.exports = require(\"axios\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"axios\"\n// module id = axios\n// module chunks = 3","module.exports = require(\"firebase\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"firebase\"\n// module id = firebase\n// module chunks = 3","module.exports = require(\"isomorphic-unfetch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"isomorphic-unfetch\"\n// module id = isomorphic-unfetch\n// module chunks = 3","module.exports = require(\"react\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react\"\n// module id = react\n// module chunks = 3"],"mappings":"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","sourceRoot":""}